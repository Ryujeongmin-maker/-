# 1.3 네트워크 코어
네트워크 코어, 즉 인터넷의 종단 시스템을 연결하는 패킷 스위치와 링크의 그물망(mesh)을 좀 더 자세히 살펴보자.

### 1.3.1 패킷 교환
•네트워크 애플리케이션에서 종단 시스템들은 서로 메세지를 교환한다.
•출발지 종단 시스템에서 목적지 종단 시스템으로 메세지를 보내기 위해 송신 시스템은 긴 메세지를 **패킷**이라고 하는 작은 데이터 덩어리로 분할한다.
-각 패킷은 통신 링크와 패킷 스위치를 거치게 된다.
-패킷 스위치는 라우터와 링크 계층 스위치 2가지 유형이 있다.

#### (1)저장-후-전달
-대부분의 패킷 스위치가 이용하는 방식.
그림 1.11을 참고
1.이 예시에서 출발지는 목적지로 전송할 3개의 패킷을 갖고 잇으며 각각은 L비트로 구성된다.
2.출발지는 패킷 1의 일부분을 전송했고 패킷 1의 앞쪽이 이미 라우터에 도착. 이순간 라우터는 저장-후-전달을 채택하기에 수신한 비트를 전송할 수 없다.
3.대신에 그 패킷의 비트를 먼저 저장한 후 라우터가 패킷의 모든 비트를 수신한 후에만 출력 링크로 그 패킷을 전송.

//이해를 돕기 위한 경과 시간 계산
출발지는 시각 0에 전송하기 시작하고, L/R초에 출발지는 전체 패킷을 전송했고 전체 패킷이 라우터에 수신되고 저장되었다.
또 그다음 L/R초에 라우터가 목적지를 향해 그 패킷을 최대 출력으로 전송하기 시작하면, 2L/R시각에 수신시스템은 전체 패킷을 수신한다.
따라서 전체 지연은 2L/R이다. 
이때 L/R 시간에 출발지에서 두번째 패킷을 송신하고 똑같은 일련의 과정을 거치면, 3개의 패킷을 모두 수신하는 시간은 4L/R이 된다.
출발지로 부터 목적지 노드까지 N개의 링크로 구성되고, 각각의 전송률이 R인 경로를 통해 하나의 패킷을 전송하는 일반적인 경우, 위의 논리를 적용하면 
d(종단 간 지연) = N * L / R 이된다.//

#### (2)큐잉 지연과 패킷 손실
•각 패킷 스위치는 접속된 여러 개의 링크를 갖고 있다.
•각 링크에 대해 패킷 스위치는 출력버퍼(출력 큐)를 갖고 있으며, 그 링크로 송신하려고 하는 패킷을 저장하고 있다.

도착하는 패킷이 한 링크로 전송되어야 하는데 그 링크가 다른 패킷을 전송하고 있다면 도착하는 패킷은 출력 버퍼에서 대기해야한다.
--> 저장-후-전달 지연뿐만 아니라, 패킷은 출력버퍼에서 큐잉 지연(queuing delay)을 겪게 된다.

• 버퍼 공간의 크기가 유한하기 때문에 도착하는 패킷은 버퍼가 전송을 위해 대기 중인 다른 패킷들로 꽉 차있는 경우를 당할 수 있다. 이경우 
**패킷 손실**(pakcet loss)가 발생한다.
⁙패킷 손실 : 도착하는 패킷 혹은 이미 큐에 대기 중인 패킷을 폐기한다.

#### (3)포워딩 테이블과 라우팅 프로토콜

라우터는 어떻게 패킷을 어느 링크로 전달해야 하는지를 결정하는가?

##### IP주소
•출발지 종단 시스템이 패킷을 목적지 종단 시스템으로 보내고자 할 때, 출발지는 패킷의 헤더에 목적지의 IP주소를 포함한다.(계층적 구조)
•각 라우터는 목적지 주소를 라우터의 출력 링크로 매핑하는 **포워딩 테이블**을 갖고 있다.
-패킷이 네트워크의 한 라우터에 도착하면 라우터는 패킷의 목적지 주소의 일부를 조사하고 스 패킷을 이웃 라우터로 전달함.

##### 라우팅프로토콜(routing protocol)
인터넷은 자동으로 포워딩 테이블을 설정하는데 이용되는 여러 특별한 라우팅 프로토콜을 갖고 있음.
-추후 5장에서 자세히 논의할 예정.

### 1.3.2 회선 교환
링크와 스위치의 네트워크를 통해 데이터를 이동시키는 방식에는 회선 교환과 패킷교환이라는 2가지 기본 방식이 있다.

•회선 교환 네트워크에서 종단 시스템 간에 통신을 제공하기 위해 경로상에 필요한 자원은 통신 세션동안에 확보 또는 예약된다.(패킷은 예약 x)
•세션 메세지는 온디맨드 방식으로 자원을 요청하여 사용하고 그 결과, 통신링크 접속을 위해 대기할 수도 있다
⁙패킷 교환 방식은 예약을 하는 레스토랑, 회선 교환 방식은 예약을 하지 않는 레스토랑에 비유함.

•회선: 송신자가 정보를 보내기 전에 네트워크는 송신자와 수신자간의 연결을 설정해야 하고, 이 연결을 유지해야 하는데 이를 회선이라 함.
-네트워크가 회선을 설정할 때, 그 연결이 이루어지는 동안 네트워크 링크에 일정한 전송률을 예약한다.
-송신자는 수신자에게 보장된 일정 전송률로 데이터를 보낼 수 있다.
